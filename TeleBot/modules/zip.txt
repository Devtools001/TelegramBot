import os
import time
import zipfile 

from TeleBot import pgram
from pyrogram import filters 
from pyrogram.enums import ChatType

TEMP_DOWNLOAD_DIRECTORY = "./"


@pgram.on_message(filters.command("zip"))
async def _zip(_, message):
    if message.sender_chat :
        return
    replied = message.reply_to_message
    if not replied:
        return await message.reply_text(" Ä·¥á·¥ò ü è ·¥õ·¥è ·¥Ä “ì…™ ü·¥á ·¥õ·¥è ·¥Ñ·¥è·¥ç·¥ò Ä·¥áss …™·¥õ.")
    administrators = []
    async for m in app.get_chat_members(chat_id, filter=enums.ChatMembersFilter.ADMINISTRATORS):
        administrators.append(m.user.id)
    if message.chat.type != ChatType.PRIVATE:
        if message.from_user.id not in administrators:
            return await message.reply_text(" ú·¥á è,  è·¥è·¥ú ·¥Ä Ä·¥á …¥·¥è·¥õ ·¥Ä·¥Ö·¥ç…™…¥.  è·¥è·¥ú ·¥Ñ·¥Ä…¥'·¥õ ·¥ús·¥á ·¥õ ú…™s ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ö, B·¥ú·¥õ  è·¥è·¥ú ·¥Ñ·¥Ä…¥ ·¥ús·¥á …™…¥ ·¥ç è PM üé≠")
    
    mone = await message.reply("‚è≥Ô∏è ·¥ò ü·¥á·¥Äs·¥á ·¥°·¥Ä…™·¥õ...")
    if not os.path.isdir(TEMP_DOWNLOAD_DIRECTORY):
        os.makedirs(TEMP_DOWNLOAD_DIRECTORY)
    
   if replied.media:
        reply_message = await replied.download()
        try:
            time.time()
            downloaded_file_name = await event.client.download_media(
                reply_message, TEMP_DOWNLOAD_DIRECTORY
            )
            directory_name = downloaded_file_name
        except Exception as e:  # pylint:disable=C0103,W0703
            await mone.reply(str(e))
    zipfile.ZipFile(directory_name + ".zip", "w", zipfile.ZIP_DEFLATED).write(
        directory_name
    )
